{
  "hash": "e45783e8aac2c37e1a7872a76fb89af4",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Data Tidying\"\nnumber-sections: true\n---\n\n\n## Clear Workspace, DON'T EDIT {-}\n\nAlways start by clearing the workspace. This ensure objects created in other files are not used used here.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrm(list = ls())\n```\n:::\n\n\n## List Used Packages, EDIT {-}\n\nList all the packages that will be used in chunk below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npackages <- c(\"styler\", \"dplyr\", \"tidyr\")\n```\n:::\n\n\n\n## Load Packages, DON'T EDIT {#sec-packages -}\n\n### Install Missing {-}\n\n::: callout-important\n\n#### Installing Packages on Other People Machine\n\nBe aware the people may not like installing packages into their machine automatically.  This might break some of their previous code.\n\n:::\n\nAny missing package will be installed automatically. This ensure smoother execution when run by others.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Do NOT modify\ninstall.packages(setdiff(packages, rownames(installed.packages())))\n```\n:::\n\n\n### Load {-}\n\nLoad all packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Do NOT modify\nlapply(packages, require, character.only = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] TRUE\n\n[[2]]\n[1] TRUE\n\n[[3]]\n[1] TRUE\n```\n\n\n:::\n:::\n\n\n## Introduction\n\nThis page explains how use the `tidyr` package to put data in tidy form where:\n\n- each row represents an observation\n- each column represents a variable\n- each cell contain a single value\n\nPutting data in tidy form will make it easy to process using tidyverse packages.\n\n::: callout-note\n\n### Data Trasformation Bottom-Line\n\nTidying is 1-to-1 process--the data takes different form but it can be put back into its original form which mean that no values are lost.\n\n:::\n\n\n\n## Lengthening Data, `pivot_longer`\n\n::: callout-note\n\n### `pivot_longer' Idea\n\nWhen pivoting longer, the number of the rows in the dataset increases while the number of columns decreases.\n\n:::\n\n### One Variable in Column Headers\n\n#### Toy Dataset\n\nThe following toy dataset will be used to illustrate the concepts in this section.  The book used `tidyr::billboard` dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds <- tribble(\n  ~id, ~A, ~B_1, ~B_2,\n  \"A\", 1, 10.1, 10.2,\n  \"B\", 2, 20.1, NA,\n  \"C\", 3, NA, 30.2\n)\n\nds\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 4\n  id        A   B_1   B_2\n  <chr> <dbl> <dbl> <dbl>\n1 A         1  10.1  10.2\n2 B         2  20.1  NA  \n3 C         3  NA    30.2\n```\n\n\n:::\n:::\n\n\n\n#### Lengthen\n\n> I want the values in all the columns that start with `B_` to be placed into a (single) column named `value`.  To distinguish which value belong to which column, create a new column called `B_type` for this purpuse.\n\n::: callout-note\n\n##### Dimensions of New Dataset\n\nAssume the dimensions of the old dataset are:\n\n- number of cols: co\n- number of rows: ro\n\nThe dimensions of the new dataset are:\n\n- number of cols: co - number of combined columns - 1\n- number of rows: ro * (number of combined columns - 1)\n\n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds_lengthen <- ds |> \n  pivot_longer(\n    cols = starts_with(\"B_\"),\n    names_to = \"B_type\",\n    values_to = \"value\"\n  )\n\nds_lengthen\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 4\n  id        A B_type value\n  <chr> <dbl> <chr>  <dbl>\n1 A         1 B_1     10.1\n2 A         1 B_2     10.2\n3 B         2 B_1     20.1\n4 B         2 B_2     NA  \n5 C         3 B_1     NA  \n6 C         3 B_2     30.2\n```\n\n\n:::\n:::\n\n\n#### Remove NA\n\nUse the argument `values_drop_na = TRUE`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds_lengthen <- ds |> \n  pivot_longer(\n    cols = starts_with(\"B_\"),\n    names_to = \"B_type\",\n    values_to = \"value\",\n    values_drop_na = TRUE\n  )\n\nds_lengthen\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 4\n  id        A B_type value\n  <chr> <dbl> <chr>  <dbl>\n1 A         1 B_1     10.1\n2 A         1 B_2     10.2\n3 B         2 B_1     20.1\n4 C         3 B_2     30.2\n```\n\n\n:::\n:::\n\n\n\n#### Fix Cell Values\n\nUse the `readr::parse_number()` function to extract the first number from var2 variable and ignore all other text.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds_lengthen <- ds |> \n  pivot_longer(\n    cols = starts_with(\"B_\"),\n    names_to = \"B_type\",\n    values_to = \"value\",\n    values_drop_na = TRUE\n  ) |> \n  mutate(\n    B_type = readr::parse_number(B_type)\n  )\n\nds_lengthen\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 4\n  id        A B_type value\n  <chr> <dbl>  <dbl> <dbl>\n1 A         1      1  10.1\n2 A         1      2  10.2\n3 B         2      1  20.1\n4 C         3      2  30.2\n```\n\n\n:::\n:::\n\n\n\n### Multiple Variables in Column Headers\n\n#### Toy Dataset\n\nThe following toy dataset will be used to illustrate the concepts in this section.  The book used `tidyr::who2` dataset. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nds2 <- tribble(\n  ~id, ~A, ~B1_C1, ~B1_C2, ~B2_C1, ~B2_C2,\n  \"A\", 1, 10.11, 10.12, 10.21, 10.22,\n  \"B\", 2, 20.11, 20.12, NA, 20.22,\n  \"C\", 3, 30.11, NA, 30.21, 30.22\n)\n\nds2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 6\n  id        A B1_C1 B1_C2 B2_C1 B2_C2\n  <chr> <dbl> <dbl> <dbl> <dbl> <dbl>\n1 A         1  10.1  10.1  10.2  10.2\n2 B         2  20.1  20.1  NA    20.2\n3 C         3  30.1  NA    30.2  30.2\n```\n\n\n:::\n:::\n\n\n#### Lengthening w/o Seperating Variables\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds_lengthen <- ds2 |> \n  pivot_longer(\n    cols = starts_with(\"B\"),\n    names_to = \"B_C\",\n    values_to = \"value\"\n  )\n\nds_lengthen\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 12 × 4\n   id        A B_C   value\n   <chr> <dbl> <chr> <dbl>\n 1 A         1 B1_C1  10.1\n 2 A         1 B1_C2  10.1\n 3 A         1 B2_C1  10.2\n 4 A         1 B2_C2  10.2\n 5 B         2 B1_C1  20.1\n 6 B         2 B1_C2  20.1\n 7 B         2 B2_C1  NA  \n 8 B         2 B2_C2  20.2\n 9 C         3 B1_C1  30.1\n10 C         3 B1_C2  NA  \n11 C         3 B2_C1  30.2\n12 C         3 B2_C2  30.2\n```\n\n\n:::\n:::\n\n\n#### Lengthening w/ Seperating Variables\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds_lengthen <- ds2 |> \n  pivot_longer(\n    cols = !(id:A),\n    names_sep = \"_\",\n    names_to = c(\"B\", \"C\"),\n    values_to = \"value\"\n  )\n\nds_lengthen\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 12 × 5\n   id        A B     C     value\n   <chr> <dbl> <chr> <chr> <dbl>\n 1 A         1 B1    C1     10.1\n 2 A         1 B1    C2     10.1\n 3 A         1 B2    C1     10.2\n 4 A         1 B2    C2     10.2\n 5 B         2 B1    C1     20.1\n 6 B         2 B1    C2     20.1\n 7 B         2 B2    C1     NA  \n 8 B         2 B2    C2     20.2\n 9 C         3 B1    C1     30.1\n10 C         3 B1    C2     NA  \n11 C         3 B2    C1     30.2\n12 C         3 B2    C2     30.2\n```\n\n\n:::\n:::\n\n\n#### Dropping NA\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds_lengthen <- ds2 |> \n  pivot_longer(\n    cols = !(id:A),\n    names_sep = \"_\",\n    names_to = c(\"B\", \"C\"),\n    values_to = \"value\",\n    values_drop_na = TRUE\n  )\n\nds_lengthen\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 5\n   id        A B     C     value\n   <chr> <dbl> <chr> <chr> <dbl>\n 1 A         1 B1    C1     10.1\n 2 A         1 B1    C2     10.1\n 3 A         1 B2    C1     10.2\n 4 A         1 B2    C2     10.2\n 5 B         2 B1    C1     20.1\n 6 B         2 B1    C2     20.1\n 7 B         2 B2    C2     20.2\n 8 C         3 B1    C1     30.1\n 9 C         3 B2    C1     30.2\n10 C         3 B2    C2     30.2\n```\n\n\n:::\n:::\n\n\n### Data and Variable Names in Colmnn Headers\n\n#### Toy Dataset\n\nThe following toy dataset will be used to illustrate the concepts in this section.  The book used `tidyr::household` dataset. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds3 <- tribble(\n  ~id, ~child1_name, ~child1_age, ~child2_name, ~child2_age,\n  \"A\", \"A1\", 11, \"A2\", 12,\n  \"B\", \"B1\", 21, NA, NA,\n  \"C\", NA, NA, \"C2\", 32\n)\n\nds3\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 5\n  id    child1_name child1_age child2_name child2_age\n  <chr> <chr>            <dbl> <chr>            <dbl>\n1 A     A1                  11 A2                  12\n2 B     B1                  21 <NA>                NA\n3 C     <NA>                NA C2                  32\n```\n\n\n:::\n:::\n\n\n#### Lengthening w/o Removing NA\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds_lengthen <- ds3 |> \n  pivot_longer(\n    cols = starts_with(\"child\"),\n    names_sep = \"_\",\n    names_to = c(\"child\", \".value\")\n  )\n\nds_lengthen\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 4\n  id    child  name    age\n  <chr> <chr>  <chr> <dbl>\n1 A     child1 A1       11\n2 A     child2 A2       12\n3 B     child1 B1       21\n4 B     child2 <NA>     NA\n5 C     child1 <NA>     NA\n6 C     child2 C2       32\n```\n\n\n:::\n:::\n\n\n#### Lengthening w Removing NA\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds_lengthen <- ds3 |> \n  pivot_longer(\n    cols = starts_with(\"child\"),\n    names_sep = \"_\",\n    names_to = c(\"child\", \".value\"),\n    values_drop_na = TRUE\n  )\n\nds_lengthen\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 4\n  id    child  name    age\n  <chr> <chr>  <chr> <dbl>\n1 A     child1 A1       11\n2 A     child2 A2       12\n3 B     child1 B1       21\n4 C     child2 C2       32\n```\n\n\n:::\n:::\n\n\n\n#### Fixing Cell Values\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds_lengthen <- ds3 |> \n  pivot_longer(\n    cols = starts_with(\"child\"),\n    names_sep = \"_\",\n    names_to = c(\"child\", \".value\"),\n    values_drop_na = TRUE\n  ) |> \n  mutate(\n    child = readr::parse_number(child)\n  )\n\nds_lengthen\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 4\n  id    child name    age\n  <chr> <dbl> <chr> <dbl>\n1 A         1 A1       11\n2 A         2 A2       12\n3 B         1 B1       21\n4 C         2 C2       32\n```\n\n\n:::\n:::\n\n\n\n## Widening Data, `pivot-wider`\n\n::: callout-note\n\n### `pivot_wider' Idea\n\nWhen pivoting wider, the number of the columns in the dataset increases while the number of rows decreases.\n\n:::\n\n\n### No Missing Values\n\n#### Toy Dataset\n\nNotice that each unique value in the `id` column has a single value for each of the unique values in the `M` column.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds <- tribble(\n  ~id, ~M, ~V,\n  \"A\", \"M1\", 10,\n  \"A\", \"M2\", 11,\n  \"B\", \"M1\", 20,\n  \"B\", \"M2\", 21,\n  \"C\", \"M1\", 30,\n  \"C\", \"M2\", 31\n)\n\nds\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  id    M         V\n  <chr> <chr> <dbl>\n1 A     M1       10\n2 A     M2       11\n3 B     M1       20\n4 B     M2       21\n5 C     M1       30\n6 C     M2       31\n```\n\n\n:::\n:::\n\n\n#### Widenning\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds_widen <- ds |> \n  pivot_wider(\n    names_from = M,\n    values_from = V\n  )\n\nds_widen\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 3\n  id       M1    M2\n  <chr> <dbl> <dbl>\n1 A        10    11\n2 B        20    21\n3 C        30    31\n```\n\n\n:::\n:::\n\n\n\n\n### Missing Values\n\n#### Toy Dataset\n\nNotice that NOT each unique value in the `id` column has a single value for each of the unique values in the `M` column--`B` does not have value for the `M2` value.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds <- tribble(\n  ~id, ~M, ~V,\n  \"A\", \"M1\", 10,\n  \"A\", \"M2\", 11,\n  \"B\", \"M1\", 20,\n  \"C\", \"M1\", 30,\n  \"C\", \"M2\", 31\n)\n\nds\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 3\n  id    M         V\n  <chr> <chr> <dbl>\n1 A     M1       10\n2 A     M2       11\n3 B     M1       20\n4 C     M1       30\n5 C     M2       31\n```\n\n\n:::\n:::\n\n\n#### Widenning\n\nNotice that `B` observation will be assigned `NA` as its value in the `M2` column.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds_widen <- ds |> \n  pivot_wider(\n    names_from = M,\n    values_from = V\n  )\n\nds_widen\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 3\n  id       M1    M2\n  <chr> <dbl> <dbl>\n1 A        10    11\n2 B        20    NA\n3 C        30    31\n```\n\n\n:::\n:::\n\n\n### Duplicate Values\n\n#### Toy Dataset\n\nNotice that NOT each unique value in the `id` column has a single value for each of the unique values in the `M` column--B has multiple value for `M2`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds <- tribble(\n  ~id, ~M, ~V,\n  \"A\", \"M1\", 10,\n  \"A\", \"M2\", 11,\n  \"B\", \"M1\", 20,\n  \"B\", \"M2\", 21,\n  \"B\", \"M2\", 22,\n  \"C\", \"M1\", 30,\n  \"C\", \"M2\", 31\n)\n\nds\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 7 × 3\n  id    M         V\n  <chr> <chr> <dbl>\n1 A     M1       10\n2 A     M2       11\n3 B     M1       20\n4 B     M2       21\n5 B     M2       22\n6 C     M1       30\n7 C     M2       31\n```\n\n\n:::\n:::\n\n\n#### Widenning\n\nNotice that the generated values are `list-cols`--see the warning message for details.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds_widen <- ds |> \n  pivot_wider(\n    names_from = M,\n    values_from = V\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Values from `V` are not uniquely identified; output will contain list-cols.\n• Use `values_fn = list` to suppress this warning.\n• Use `values_fn = {summary_fun}` to summarise duplicates.\n• Use the following dplyr code to identify duplicates.\n  {data} |>\n  dplyr::summarise(n = dplyr::n(), .by = c(id, M)) |>\n  dplyr::filter(n > 1L)\n```\n\n\n:::\n\n```{.r .cell-code}\nds_widen\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 3\n  id    M1        M2       \n  <chr> <list>    <list>   \n1 A     <dbl [1]> <dbl [1]>\n2 B     <dbl [1]> <dbl [2]>\n3 C     <dbl [1]> <dbl [1]>\n```\n\n\n:::\n:::\n\n\n## Reference\n\n- Wickham, H. . (2014). Tidy Data. Journal of Statistical Software, 59(10), 1–23. https://doi.org/10.18637/jss.v059.i10 ([webpage](https://www.jstatsoft.org/article/view/v059i10))\n    - details the history and underlying theory behind tidy data\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}